---
title: memoã€useMemoã€useCallbackåœ¨Reactä¸­çš„ä½¿ç”¨åœºæ™¯
desc: é€šè¿‡ä¸€äº›åœºæ™¯æ¥ä»‹ç»ä¸€ä¸‹memoã€useMemoã€useCallbackåœ¨Reacté¡¹ç›®ä¸­çš„ä½¿ç”¨åœºæ™¯ï¼Œä¸»è¦æ˜¯åœ¨æ–°é¡¹ç›®ä¸­çœ‹åˆ°äº†å¥½å¤šä½¿ç”¨çš„åœºæ™¯ä»¥åŠä¹‹å‰åœ¨ç›¸å¯¹è¾ƒå°çš„é¡¹ç›®ä¸­æœªè€ƒè™‘çš„ä¸€äº›ä¼˜åŒ–é—®é¢˜ï¼Œå€Ÿæ­¤æ–‡æ¥å­¦ä¹ è®°å½•ä¸€ä¸‹ã€‚
publishDate: '2022-04-15'
image: https://cdn.laughingzhu.cn/2dd2c8dd-b108-4b02-86d7-5cd295e12df8.png
category: blog
author: LaughingZhu
tags: [Blog, React]
---

## èƒŒæ™¯ï¼š

é€šè¿‡ä¸€äº›åœºæ™¯æ¥ä»‹ç»ä¸€ä¸‹memoã€useMemoã€useCallbackåœ¨Reacté¡¹ç›®ä¸­çš„ä½¿ç”¨åœºæ™¯ï¼Œä¸»è¦æ˜¯åœ¨æ–°é¡¹ç›®ä¸­çœ‹åˆ°äº†å¥½å¤šä½¿ç”¨çš„åœºæ™¯ä»¥åŠä¹‹å‰åœ¨ç›¸å¯¹è¾ƒå°çš„é¡¹ç›®ä¸­æœªè€ƒè™‘çš„ä¸€äº›ä¼˜åŒ–é—®é¢˜ï¼Œå€Ÿæ­¤æ–‡æ¥å­¦ä¹ è®°å½•ä¸€ä¸‹ã€‚

## å‰ç½®çš„çŸ¥è¯†ï¼š

éœ€äº†è§£å˜é‡çš„ä¸¤ç§ç±»å‹ï¼šåŸºæœ¬ç±»å‹(numberã€stringã€booleanç­‰)ã€å¼•ç”¨ç±»å‹(arrayã€objectã€functionç­‰)ã€‚
äº†è§£äº†ä¸¤ç§ç±»å‹åå°±å¾ˆå¥½ç†è§£ï¼š

```typescript
'a' === 'a'   // true
{} === {}    // false
```

## 1.React.memo()

### åœºæ™¯æè¿°ï¼š

æˆ‘ä»¬çŸ¥é“åœ¨Reactä¸­ç»„ä»¶çš„propsã€stateçš„æ”¹å˜ä¼š**é‡æ–°æ¸²æŸ“é¡µé¢**ï¼Œä½†æœ‰äº›æƒ…å†µä¸‹æˆ‘ä»¬å¹¶ä¸æœŸæœ›ã€‚å¦‚ä¸‹é¢çš„ä¾‹å­ã€‚

```typescript
// Parent
import { useState } from "react";
import { Child } from "./child";
export const Parent = () => {
  const [count, setCount] = useState(0);
  const increment = () => setCount(count + 1);
  return (
    <div>
      <button onClick={increment}>add countï¼š{count}</button>
      <Child />
    </div>
  );
};

// Child
export const Child = () => {
  console.log("child render");
  return <div>å­ç»„ä»¶</div>;
};
```

ç‚¹å‡»çˆ¶ç»„ä»¶ä¸­æŒ‰é’®ï¼Œä¼šä¿®æ”¹ count å˜é‡çš„å€¼ï¼Œè¿›è€Œå¯¼è‡´çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œæ­¤æ—¶å­ç»„ä»¶æ²¡æœ‰ä»»ä½•å˜åŒ–(propsã€state)ï¼Œä½†åœ¨æ§åˆ¶å°ä¸­ä»ç„¶çœ‹åˆ°å­ç»„ä»¶è¢«æ¸²æŸ“çš„æ‰“å°ä¿¡æ¯ã€‚
![image.png](https://cdn.laughingzhu.cn/1649942616526-e56a1204-c778-4100-9b73-768aa4668600.png)
ç”±äºè¿™é‡Œå­ç»„ä»¶å¹¶æ²¡æœ‰ä¾èµ–çˆ¶ç»„ä»¶çš„stateã€propsï¼Œæ‰€ä»¥ç†è®ºä¸Šæˆ‘ä»¬æ˜¯ä¸æœŸæœ›Childå¤šæ¬¡æ¸²æŸ“çš„ï¼Œè¿™é‡Œå°±å¯ä»¥é€šè¿‡ä½¿ç”¨[React.memo()](https://cdn.laughingzhu.cn/https://zh-hans.reactjs.org/docs/react-api.html#reactmemo)æ¥è§£å†³ã€‚

### è§£å†³æ–¹æ¡ˆï¼š

React.memo()æ˜¯React v16.6å¼•å…¥çš„å±æ€§ï¼Œç”¨æ¥è§£å†³å‡½æ•°çš„é‡æ–°æ¸²æŸ“é—®é¢˜ã€‚å°†ç»„ä»¶ä½œä¸ºå‡½æ•°(memo)çš„å‚æ•°ï¼Œå‡½æ•°çš„è¿”å›å€¼(Child)æ˜¯ä¸€ä¸ªæ–°çš„ç»„ä»¶ã€‚

```typescript
// åœºæ™¯1ï¼šé€‚ç”¨äºpropsä¸ºåŸºç¡€ç±»å‹æˆ–è€…æ— éœ€ä¾èµ–propsçš„åœºæ™¯ä¸­
const MyComponent = React.memo(function MyComponent(props) {
  /* ä½¿ç”¨ props æ¸²æŸ“ */
});

// åœºæ™¯2ï¼šé€‚ç”¨äºåœºæ™¯1ï¼Œåˆ‡é€‚ç”¨äºpropsä¸ºå¼•ç”¨ç±»å‹
// éœ€è¦æ¯”è¾ƒprops,å¯ä»¥é€šè¿‡ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°æ¥åˆ¤æ–­æ˜¯å¦è¦éœ€è¦é‡æ–°æ¸²æŸ“
function MyComponent(props) {
  /* ä½¿ç”¨ props æ¸²æŸ“ */
}
function areEqual(prevProps, nextProps) {
  /*
  å¦‚æœæŠŠ nextProps ä¼ å…¥ render æ–¹æ³•çš„è¿”å›ç»“æœä¸
  å°† prevProps ä¼ å…¥ render æ–¹æ³•çš„è¿”å›ç»“æœä¸€è‡´åˆ™è¿”å› trueï¼Œ
  å¦åˆ™è¿”å› false
  ä¸Classä¸­shouldComponentUpdateè¿”å›å€¼ç›¸å
  */
}
export default React.memo(MyComponent, areEqual);


<!----------------å°†æˆ‘ä»¬çš„ä»£ç ä½¿ç”¨memoä¼˜åŒ–-------------------->

// Child
const Child = React.memo(() => {
  console.log("child render");
  return <div>Child</div>;
});
```

æ•ˆæœå¦‚ä¸‹ï¼Œçˆ¶ç»„ä»¶æ¸²æŸ“äº†å¤šæ¬¡ï¼Œä½†å­ç»„ä»¶åªæ¸²æŸ“äº†ä¸€æ¬¡ï¼š
![image.png](https://cdn.laughingzhu.cn/1649943652691-e382e4e4-4e02-4e83-9a28-fce2767492e8.png)

## 2.React.useCallback()

### åœºæ™¯æè¿°ï¼š

ä¸Šé¢memoçš„åœºæ™¯ä¸­æˆ‘ä»¬åªæ˜¯ç®€å•çš„è°ƒç”¨ç»„ä»¶ï¼Œå¹¶æ²¡æœ‰ç»™ç»„ä»¶ä¼ é€’ä»»ä½•å±æ€§ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¼ å€¼çœ‹çœ‹ï¼š

```typescript
// çˆ¶ç»„ä»¶
export const Parent = () => {
  const [count, setCount] = useState(0);
  const [name, setName] = useState("LaughingZhu");
  const add = () => setCount(count + 1);
  const onClick = (name: string) => {
    setName(name);
  };
  return (
    <div>
      <button onClick={add}>ç‚¹å‡»æ¬¡æ•°ï¼š{count}</button>
      <Child name={name} onClick={onClick} />
    </div>
  );
};

// å­ç»„ä»¶
export const Child = memo((props: { name: string; onClick: (value: any) => void}) => {
    const { name, onClick } = props;
    console.log("æ¸²æŸ“äº†", name, onClick);
    return (
      <>
        <div>å­ç»„ä»¶</div>
        <button onClick={() => onClick("æ™“")}> æ”¹å˜ name å€¼</button>
      </>
    );
  }
);
```

ç‚¹å‡»çˆ¶ç»„ä»¶countï¼Œçœ‹åˆ°å­ç»„ä»¶æ¯æ¬¡éƒ½é‡æ–°æ¸²æŸ“äº†ã€‚

![image.png](https://cdn.laughingzhu.cn/1649950569865-871babb0-bfed-47b1-ae9e-f395eeb05b57.png)
![image.png](https://cdn.laughingzhu.cn/1649950527044-196fc0ea-9836-4f39-b0e3-70b3a6a6c78e.png)

**åˆ†æåŸå› ï¼š**
ç‚¹å‡»çˆ¶ç»„ä»¶æŒ‰é’®ï¼Œæ”¹å˜äº†çˆ¶ç»„ä»¶ä¸­countå˜é‡ï¼Œè¿›è€Œå¯¼è‡´çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼›
çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œä¼šé‡æ–°åˆ›å»ºonClickå‡½æ•°ï¼Œå³ä¼ ç»™å­ç»„ä»¶çš„onClickå±æ€§å‘ç”Ÿäº†å˜åŒ–ï¼Œå¯¼è‡´å­ç»„ä»¶æ¸²æŸ“ï¼›
å¦‚æœä¼ ç»™å­ç»„ä»¶çš„propsåªæœ‰åŸºæœ¬ç±»å‹åŒä¸Šä¸€ä¸ªmemoäº‹ä¾‹å°±ä¸ä¼šé‡æ–°æ¸²æŸ“ã€‚

**æ³¨æ„: **å¦‚æœç›´æ¥ä½¿ç”¨**useStateè§£æ„**çš„setNameä¼ ç»™å­ç»„ä»¶, å­ç»„ä»¶å°†ä¸ä¼šé‡å¤æ¸²æŸ“ï¼Œå› ä¸ºè§£æ„å‡ºæ¥çš„æ˜¯ä¸€ä¸ª**memoized å‡½æ•°**ã€‚

```typescript
// å¦‚ä¸‹è¾¹çš„ä¾‹å­, å¤šæ¬¡ç‚¹å‡»buttonï¼Œå­ç»„ä»¶ä¸ä¼šé‡æ–°æ¸²æŸ“
import { useState } from "react";
import { Child } from "./child";

export const Parent = () => {
  const [count, setCount] = useState(0);
  const [name, setName] = useState("å°æ˜");
  const increment = () => setCount(count + 1);

  return (
    <div>
      <button onClick={increment}>ç‚¹å‡»æ¬¡æ•°ï¼š{count}</button>
      <Child setName={setName} />
    </div>
  );
};

```

### è§£å†³æ–¹æ¡ˆï¼š

æŠŠå†…è”å›è°ƒå‡½æ•°åŠä¾èµ–é¡¹ä½œä¸ºå‚æ•°ä¼ å…¥[useCallback](https://zh-hans.reactjs.org/docs/hooks-reference.html#usecallback)ï¼Œå®ƒå°†è¿”å›æ”¹å‡½æ•°çš„memoizedå›è°ƒå‡½æ•°ï¼Œè¯¥å›è°ƒå‡½æ•°ä»…åœ¨æŸä¸ªä¾èµ–é¡¹æ”¹å˜æ—¶æ‰ä¼šæ›´æ–°ã€‚å½“ä½ æŠŠå›è°ƒå‡½æ•°ä¼ é€’ç»™ç»è¿‡ä¼˜åŒ–çš„å¹¶ä½¿ç”¨å¼•ç”¨ç›¸ç­‰æ€§å»é¿å…éå¿…è¦æ¸²æŸ“ï¼ˆåˆ—å…¥class ç»„ä»¶çš„shouldComponentUpdateï¼‰çš„å­ç»„ä»¶æ—¶ï¼Œä»–å°†éå¸¸æœ‰ç”¨ã€‚

> **memoizedå›è°ƒå‡½æ•°ï¼š**ä½¿ç”¨ä¸€ç»„å‚æ•°**åˆæ¬¡è°ƒç”¨å‡½æ•°æ—¶ï¼Œç¼“å­˜å‚æ•°å’Œè®¡ç®—ç»“æœ**ï¼Œå½“å†æ¬¡ä½¿ç”¨ç›¸åŒçš„å‚æ•°è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œç›´æ¥è¿”å›ç›¸åº”çš„**ç¼“å­˜ç»“æœ**ã€‚ï¼ˆè¿”å›å¯¹åº”çš„å¼•ç”¨ï¼Œå³å¼•ç”¨åœ°å€æ²¡æœ‰å˜ï¼Œæ‰€ä»¥ === æˆç«‹ï¼‰ã€‚
>
> **æ³¨æ„ï¼š**ä¾èµ–é¡¹æ•°ç»„ä¸ä¼šä½œä¸ºå‚æ•°ä¼ é€’ç»™å›è°ƒå‡½æ•°ï¼Œè™½ç„¶ä»**æ¦‚å¿µä¸Šæ¥è¯´å®ƒè¡¨ç°ä¸º**ï¼šæ‰€æœ‰å›è°ƒå‡½æ•°ä¸­å¼•ç”¨çš„å€¼éƒ½åº”è¯¥å‡ºç°åœ¨ä¾èµ–é¡¹æ•°ç»„ä¸­ã€‚

æ¥ä¸‹æ¥ä½¿ç”¨**useCallback**å‡½æ•°åŒ…è£¹æˆ‘ä»¬ä¸Šè¿°ä¾‹å­ä¸­çš„onClickå‡½æ•°ï¼š

```typescript
// çˆ¶ç»„ä»¶
export const Parent = () => {
  const [count, setCount] = useState(0);
  const [name, setName] = useState("LaughingZhu");
  const add = () => setCount(count + 1);
  const onClick = useCallback(() => {
    setName(name);
  }, [name])

  return (
    <div>
      <button onClick={add}>ç‚¹å‡»æ¬¡æ•°ï¼š{count}</button>
      <Child name={name} onClick={onClick} />
    </div>
  );
};

```

![image.png](https://cdn.laughingzhu.cn/1649988234999-9abac76d-e38e-4a80-997d-890b3b36a9a9.png)
![image.png](https://cdn.laughingzhu.cn/1649988254079-b7d75e06-62b9-4ad8-bddf-991efbfcf4e7.png)

ä»ä»£ç å¯çŸ¥ï¼Œé™¤äº†ç»„ä»¶åˆå§‹åŒ–ä¹‹å¤–ï¼Œåªæœ‰å½“çˆ¶ç»„ä»¶ä¸­**nameçš„å±æ€§æ”¹å˜**å¤–ï¼ŒonClickå‡½æ•°æ‰ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å¼•ç”¨ï¼Œé™¤æ­¤ä¹‹å¤–ä¸ä¼šå¼•èµ·å­ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚

## 3.React.useMemo()

### åœºæ™¯æè¿°ï¼š

ä¸Šè¿°çš„ä¾‹å­ä¸­ï¼Œnameæ˜¯ä¸ªå­—ç¬¦ä¸²ï¼Œæ€è€ƒå¦‚æœæ¢æˆä¼ é€’å¼•ç”¨ç±»å‹ï¼ˆarrayã€objectç­‰ï¼‰ä¼šæ€æ ·ğŸ¤”ï¼Ÿæˆ‘ä»¬åŠ¨æ‰‹æ“ä½œè¯•è¯•çœ‹ã€‚

```typescript
// çˆ¶ç»„ä»¶
const Parent = () => {
  const [count, setCount] = useState(0);
  // const [userInfo, setUserInfo] = useState({
  // 	 name: 'Laughingzhu',
  //   sex: 'boy'
  // });
  const userInfo = {
    name: "LaughingZhu",
    sex: "boy"
  };
  const add = () => {
    setCount(count + 1);
  };
  return (
    <div>
      <button onClick={add}>ç‚¹å‡»æ¬¡æ•°ï¼š{count}</button>
      <Child userInfo={userInfo} />
    </div>
  );
};

// å­ç»„ä»¶
const Child = memo((props: { userInfo: { name: string, sex: string } }) => {
  const { userInfo } = props;
  console.log("æ¸²æŸ“äº†", props.userInfo);
  return (
    <>
      <div>å§“åï¼š {userInfo.name}</div>
      <div>æ€§åˆ«ï¼š {userInfo.sex}</div>
    </>
  );
});
```

![image.png](https://cdn.laughingzhu.cn/1649990478202-cfb604e1-dd64-4ac8-9335-817570d57ecb.png)
å¦‚å›¾ï¼Œå½“ç‚¹å‡»çˆ¶ç»„ä»¶countæ—¶ï¼Œæ¯æ¬¡å­ç»„ä»¶éƒ½é‡æ–°æ¸²æŸ“äº†ï¼Œä½†å…¶å®å­ç»„ä»¶æ¥å—çš„å‚æ•°userInfoå†…å®¹æ˜¯æ²¡æœ‰å˜æ›´çš„
**åˆ†æåŸå› **è·Ÿç›´æ¥ä¼ ä¸€ä¸ªå‡½æ•°æ˜¯ä¸€æ ·çš„ï¼š

```
- ç‚¹å‡»çˆ¶ç»„ä»¶æŒ‰é’®ï¼Œè§¦å‘çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼›
- çˆ¶ç»„ä»¶æ¸²æŸ“ï¼Œconst userInfo = { name: 'LaughingZhu', sex: 'boy' }; ä¸€è¡Œä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå¯¼è‡´ä¼ é€’ç»™å­ç»„ä»¶çš„userInfoå±æ€§å€¼å˜åŒ–ï¼ˆç”±äºæ˜¯**å¼•ç”¨ç±»å‹**ï¼Œè¿™é‡ŒæŒ‡userInfoåœ¨å†…å­˜ä¸­çš„**æŒ‡é’ˆ**æŒ‡å‘å˜äº†ï¼‰ï¼Œè¿›è€Œå¯¼è‡´å­ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚
- æ³¨æ„ï¼šå¦‚æœä½¿ç”¨**useStateè§£æ„**çš„userInfoï¼Œå­ç»„ä»¶ä¸ä¼šé‡æ–°æ¸²æŸ“ï¼Œå› ä¸º**è§£æ„**å‡ºæ¥çš„æ˜¯ä¸€ä¸ª**memoizedå€¼**ã€‚
```

### è§£å†³æ–¹æ¡ˆï¼š

ä½¿ç”¨[useMemo](https://zh-hans.reactjs.org/docs/hooks-reference.html#usememo)å°†å¯¹è±¡å±æ€§åŒ…ä¸€å±‚ï¼Œä»£ç å¦‚ä¸‹ï¼š

```typescript
// çˆ¶ç»„ä»¶
export const Parent = () => {
  const [count, setCount] = useState(0);
  const userInfo = useMemo(() => (
    {
      name: "LaughingZhu",
      sex: "boy"
    }
  ), []);
  const add = () => {
    setCount(count + 1);
  };
  return (
    <div>
      <button onClick={add}>ç‚¹å‡»æ¬¡æ•°ï¼š{count}</button>
      <Child userInfo={userInfo} />
    </div>
  );
};

// å­ç»„ä»¶
const Child = memo((props:
  {
    userInfo: {
      name: string,
      sex: string
    }
  }
) => {
  const { userInfo } = props;
  console.log("æ¸²æŸ“äº†", props.userInfo);
  return (
    <>
      <div>å§“åï¼š {userInfo.name}</div>
      <div>æ€§åˆ«ï¼š {userInfo.sex}</div>
    </>
  );
});
```

![image.png](https://cdn.laughingzhu.cn/1649991464040-c04626f3-e9e9-4679-a2c2-629405526aca.png)

**useMemo()**è¿”å›ä¸€ä¸ª**memoized**å€¼ã€‚æŠŠâ€œåˆ›å»ºâ€å‡½æ•°å’Œä¾èµ–é¡¹æ•°ç»„ä½œä¸ºå‚æ•°ä¼ å…¥useMemo,å®ƒä¼šä»…åœ¨**æŸä¸ªä¾èµ–æ”¹å˜**æ—¶æ‰**é‡æ–°è®¡ç®—memoizedå€¼**ï¼Œè¿™ä¸­ä¼˜åŒ–æœ‰åŠ©äº**é¿å…æ¯æ¬¡æ¸²æŸ“**æ—¶éƒ½è¿›è¡Œé«˜å¼€é”€çš„è®¡ç®—ã€‚

**æ³¨æ„ï¼š**ä¼ å…¥useMemoçš„å‡½æ•°åœ¨æ¸²æŸ“æœŸé—´æ‰§è¡Œï¼Œè¯·ä¸è¦åœ¨è¿™ä¸ªå‡½æ•°å†…éƒ¨æ‰§è¡Œä¸æ¸²æŸ“æ— å…³çš„æ“ä½œï¼Œè¯¸å¦‚å‰¯ä½œç”¨è¿™ç±»çš„æ“ä½œå±äºuseEffectçš„ä½¿ç”¨èŒƒç•´ã€‚

å¦‚æœæ²¡æœ‰æä¾›ä¾èµ–æ•°ç»„é¡¹ï¼Œåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šè®¡ç®—æ–°çš„å€¼ï¼Œæ­¤æ—¶å’Œæ²¡ä½¿ç”¨useMemoä½œç”¨ç›¸åŒã€‚

**æ€»ç»“ï¼š**React.memoã€React.useCallbackã€React.useMemoéƒ½æ˜¯é’ˆå¯¹å‡½æ•°ç»„ä»¶ä½¿ç”¨çš„ï¼Œç›®çš„æ˜¯é¿å…å­ç»„ä»¶é‡å¤æ— æ•ˆçš„æ¸²æŸ“ã€‚
