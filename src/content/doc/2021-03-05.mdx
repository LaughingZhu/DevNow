---
title: æˆ‘çš„åšå®¢å¼€å‘ä¹‹Quill
desc: åšå®¢ç³»ç»Ÿä¸­é’ˆå¯¹Quillå¯Œæ–‡æœ¬ç¼–è¾‘å™¨çš„ä½¿ç”¨é…ç½®å’Œè¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜åŠè§£å†³æ–¹æ³•ã€‚
publishDate: '2021-03-05'
image: https://cdn.laughingzhu.cn/1a1923e7-119a-475d-a06f-3578b8cb5e58.png
category: blog
author: LaughingZhu
tags: [Blog]
---

## ç®€ä»‹ï¼š

å»å¹´ç”¨Vueå…¨å®¶æ¡¶ + MongoDB + Egg.jsæ­å»ºäº†ä¸€ä¸ªç®€æ˜“çš„åšå®¢ï¼Œæ¥è§¦Reactä¸€å¹´å¤šäº†ï¼Œæ˜¯æ—¶å€™å±•ç°çœŸæ­£çš„æŠ€æœ¯äº†ï¼Œç”¨Reactæ¥é‡æ„æˆ‘çš„åšå®¢ç³»ç»Ÿã€‚
ä½œä¸ºä¸€ä¸ªåšå®¢ç³»ç»Ÿï¼Œæ–°å»ºã€ç¼–è¾‘æ–‡ç« ä¾¿æ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒï¼Œæ‰€ä»¥åœ¨æ–‡æœ¬ç¼–è¾‘å™¨è¿™é‡Œçº ç»“äº†å¥½ä¹…ï¼Œè„‘æµ·ä¸­æœ‰å°è±¡çš„å¤§æ¦‚æœ‰[wangEditor](http://www.wangeditor.com/)ã€[TinyMCE](https://www.tiny.cloud/)ã€[Froala](https://www.froala.com/)ã€[Quill](https://quilljs.com/guides/why-quill/)ç­‰ï¼Œå¯¹æ¯”æ¥å¯¹æ¯”å»é€‰æ‹©äº†é¢œå€¼å’Œå®åŠ›å¹¶å­˜çš„Quillã€‚

## ç¼–è¾‘å™¨çš„éœ€æ±‚ï¼š

- **æ­£å¸¸çš„æ–‡å­—ç¼–è¾‘**ï¼ˆmarkdownçš„åŸºæœ¬å†…å®¹ï¼Œè¿™ä¸ªåŸºæœ¬ä¸Šæ‰€æœ‰çš„ç¼–è¾‘å™¨éƒ½æœ‰ï¼‰
- **æ”¯æŒä»£ç æ ¼å¼**ï¼ˆæ¯•ç«Ÿæ˜¯åšå®¢å¤šæ˜¯ç”¨æ¥ç¼–å†™æŠ€æœ¯åˆ†äº«ä¹‹ç±»çš„æ–‡å­—ï¼Œcodeæ”¯æŒä¸ºåˆšéœ€ï¼Œä»£ç é«˜äº®ï¼‰
- **å¯å¯¼å‡ºæµè§ˆå™¨æ˜“è§£æçš„æ–‡ç« æ ¼å¼**ï¼ˆå¸¸è§çš„å¤šç›´æ¥æ˜¯htmlæ ‡ç­¾ï¼Œç¼ºç‚¹æ˜¯éæµè§ˆå™¨ä¸å¥½è§£æï¼‰
- **æ”¯æŒåª’ä½“ä¸Šä¼ **ï¼ˆå›¾ç‰‡ä¸ºåˆšéœ€ã€è§†é¢‘æ”¯æŒæœ€å¥½ï¼‰
- **æ‰©å±•æ€§å¥½**ï¼ˆæ–¹ä¾¿åç»­è¿›è¡Œé’ˆå¯¹æ€§çš„æ‰©å±•ï¼‰
- **é¢œå€¼è¿‡çš„å»**ï¼ˆå¯¹äºé¢œå€¼è¿˜æ˜¯æœ‰ä¸€ç‚¹ç‚¹éœ€æ±‚çš„ï¼‰

ç»¼åˆä¸Šè¿°çš„éœ€æ±‚ï¼ŒQuillæ˜¯æˆ‘æœ€å¥½çš„é€‰æ‹©ï¼Œstarä¹Ÿå¾ˆé«˜ï¼ŒAnt Designç¤¾åŒºä¹Ÿæœ‰æ¨èã€‚è¿™é‡Œè¿˜æœ‰å®˜æ–¹ç»™å‡ºçš„ä¸€ç¯‡æ–‡ç« [ã€Šä¸ºä»€ä¹ˆé€‰æ‹©Quillã€‹](https://quilljs.com/guides/why-quill/) [ã€Šéå®˜æ–¹ç¿»è¯‘çš„ä¸­æ–‡æ–‡æ¡£ğŸ˜‚ã€‹](https://kang-bing-kui.gitbook.io/quill/zhi-nan-guides/whyquill)ã€‚
æ‰“ä¸ªå¹¿å‘Šï¼š[è¯­é›€](https://www.yuque.com/dashboard)é‡Œè¾¹çš„ç¼–è¾‘å™¨å¾ˆä¸é”™ï¼ŒğŸ¤·â€â™€ï¸æ— å¥ˆä¸å¼€æºé¸­~

## **Quillå°è¯•ç‰›åˆ€**ï¼š

å¦‚ä½•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨Quillç¼–è¾‘å™¨ï¼Œå®˜æ–¹çš„documentå…¶å®å·²ç»è¯´çš„å¾ˆæ˜ç™½äº†ï¼Œè¿™é‡Œåªæ˜¯ç®€å•è®°å½•ğŸ“ä¸€ä¸‹è¿‡ç¨‹å’Œä¸­é—´é‡åˆ°çš„é—®é¢˜ï¼Œæ¯•ç«Ÿå¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´ğŸ˜…ã€‚ä»¥ä¸‹éƒ½æ˜¯åŸºäºæˆ‘åšå®¢å¼€å‘ä½¿ç”¨Quillç¼–è¾‘å™¨çš„ä¸Šæ‰‹è®°å½•ï¼ˆåšå®¢æ˜¯**React**æ¡†æ¶ï¼‰ã€‚

---

### 1.é¡¹ç›®ä¸­å®‰è£…Quill

```javascript
npm install quill@1.3.6
```

### 2.åœ¨é¡µé¢ä¸­ä½¿ç”¨

```javascript
// å¼•å…¥quillåŠç›¸å…³æ ·å¼
import React, { PureComponent } from 'react';
import Quill from 'quill';
import 'quill/dist/quill.snow.css';

class Edit extends PureComponent {
  componentDidMount = () => {
    this._initQuill();
  };

  // åˆå§‹åŒ–Quill
  _initQuill = () => {
    let options = {
      debug: 'false',
      modules: {
        toolbar: {
          container: [
            ['bold', 'italic', 'underline', 'strike'], // toggled buttons
            ['blockquote', 'code-block'],
            [{ header: [1, 2, 3, 4, 5, 6, false] }], // custom button values
            [{ list: 'ordered' }, { list: 'bullet' }],
            [{ color: [] }, { background: [] }], // dropdown with defaults from theme
            [{ font: [] }],
            [{ align: [] }],
            ['link', 'image'],
            ['emoji'],
            ['clean'] // remove formatting button
          ]
        }
      },

      placeholder: 'Write something...',
      // readOnly: true,
      theme: 'snow'
    };

    this.richText = new Quill('#admin-edit-richtext', options);
  };

  render() {
    return (
      <div className='edit'>
        <div id='admin-edit-richtext' />
      </div>
    );
  }
}
```

ç°åœ¨é¡µé¢ä¸­å°±ä¼šå‡ºç°quillçš„ç¼–è¾‘å™¨äº†ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦å»å¸ƒå±€æƒ³è¦æ˜¾ç¤ºçš„ä½ç½®ã€‚

### 3.ä¸ªæ€§åŒ–é…ç½®

#### ä»£ç é«˜äº®ï¼š

åŸºäº[highlightjs](https://highlightjs.org/)å®ç°ï¼Œè¿™ä¸ªçœ‹ä¸ªäººå–œå¥½äº†ï¼Œéå¿…é¡»å®ç°ï¼Œåšå®¢ä¸­æœ‰ç”¨ï¼Œå°±è®°å½•ä¸€ä¸‹ï¼Œæ­¤å¤„æœ‰å‘ï¼Œbe carefulğŸ’¥ã€‚

```javascript
// å®‰è£…highlightjs
npm install highlight.js

// åœ¨é¡µé¢ä¸­å¼•å…¥highlight.jså’Œç›¸å…³æ ·å¼æ–‡ä»¶
// edit.tsx é¡µé¢ä¸­
import hljs from 'highlight.js';
import 'highlight.js/styles/darcula.css';    è¿™ä¸ªæ˜¯æˆ‘vsCodeä¸­çš„ä¸»é¢˜ï¼Œå¯ä»¥åˆ°è‡ªè¡Œæ›¿æ¢å…¶å®ƒé«˜äº®æ ·å¼

// é…ç½®highlight
// åœ¨_initQuillå‡½æ•°ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç 

_initQuill = () => {
  // æ­¤é…ç½®ä¸€å®šè¦åœ¨å®ä¾‹åŒ–Quillç¼–è¾‘å™¨å‰ï¼Œç›¸å½“äºæ³¨å†Œé…ç½®
  hljs.configure({
    languages: ['javascript', 'php', 'python']
  });


  let options = {
      debug: 'false',
      modules: {
        // syntax: true,è¿™æ˜¯å®˜æ–¹ç»™çš„å®ä¾‹ï¼Œè¿™é‡Œæ˜¯å‘ï¼Œç»è¿‡ä¸€ç•ªæŸ¥çœ‹ï¼Œå¤§æ¦‚å°±æ˜¯highlightæ˜¯åŸºäº<pre><code></code></pre>æ ‡ç­¾å®ç°é«˜äº®ï¼Œä½†æ˜¯quillä¸­æ²¡æœ‰ï¼Œæ‰€ä»¥è¿™æ ·å†™æ˜¯ä¸èƒ½å®ç°ï¼Œâ¬æ¢æˆä¸‹æ–¹çš„å³å¯ã€‚
        syntax:  {
          highlight: (text: string) => hljs.highlightAuto(text).value,
        },
        toolbar: {}
      }
  }

}
```

#### è‡ªå®šä¹‰å›¾ç‰‡å¤„ç†å‡½æ•°ï¼š

è‡ªå®šä¹‰ä¸Šä¼ å›¾ç‰‡å‡½æ•°ï¼Œå¯ç”¨äºå‹ç¼©å›¾ç‰‡ã€ä¸Šä¼ å›¾ç‰‡åˆ°ä¸ƒç‰›äº‘ç­‰CDNï¼Œè¿”å›å›¾ç‰‡é“¾æ¥ç„¶ååœ¨å¯¹åº”ä½ç½®æ’å…¥å›¾ç‰‡ã€‚

```javascript
// åœ¨quillçš„é…ç½®é¡¹ä¸­æ·»åŠ 

_initQuill = () => {
  let options = {
    debug: 'false',
    modules: {
      syntax:  {
        highlight: (text: string) => hljs.highlightAuto(text).value,
      },
      toolbar: {
        container: [],
        handlers: {
          image: this.imageHandle,   // åœ¨è¿™é‡Œè‡ªå®šä¹‰å¤„ç†å‡½æ•°
        },
      },
    },
    placeholder: 'Write something...',
    // readOnly: true,
    theme: 'snow',
  };
  this.richText = new Quill('#admin-edit-richtext', options)
}

// è‡ªå®šä¹‰å›¾ç‰‡å¤„ç†å‡½æ•°
imageHandle = () => {
  let richEdit = this.richText
  const input = document.createElement('input')
  input.setAttribute('type', 'file')
  input.setAttribute('accept', 'image/*')
  input.click()
  input.onchange = () => {
      // ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨ æ„å»ºformData
      const file = input.files[0]
      const formData = new FormData()
      formData.append('file', file)
      this.uploadFile(formData, (url) => {
        // å¾…æœåŠ¡å™¨è¿”å›å›¾ç‰‡çš„urlï¼Œè·å–å›¾ç‰‡æ’å…¥çš„ä½ç½®ï¼Œå¹¶é€šè¿‡insertEmbed(index, 'image', url)æ’å…¥åˆ°å¯¹åº”ä½ç½®
        const range = richEdit.getSelection()
        richEdit.insertEmbed(range.index, 'image', url)
      })
      // this part the image is inserted
      // by 'image' option below, you just have to put src(link) of img here.
  }
}
```

#### Emojiè¡¨æƒ…çš„æ·»åŠ ï¼š

å’Œä»£ç é«˜äº®ç±»ä¼¼ï¼ŒåŸºäº[quill-emoji](https://github.com/contentco/quill-emoji)è¿™ä¸ªåº“å®ç°ã€‚

```javascript
// å®‰è£…
npm install quill-emoji

// é¡µé¢ä¸­å¼•å…¥ç›¸å…³æ–‡ä»¶ edit.tsx
import emoji from 'quill-emoji'
import 'quill-emoji/dist/quill-emoji.css'

// é…ç½®

_initQuill = () => {
	hljs.configure({});

  // æ³¨å†Œåæ–¹å¯ä½¿ç”¨
  Quill.register({
    'formats/emoji': EmojiBlot,
    'modules/emoji-shortname': ShortNameEmoji,
    'modules/emoji-toolbar': ToolbarEmoji,
    'modules/emoji-textarea': TextAreaEmoji,
  }, true);

  let options = {
    debug: 'false',
    modules: {
      syntax:  {
        highlight: (text: string) => hljs.highlightAuto(text).value,
      },
      toolbar: {
        container: [],
        handlers: {
          image: this.imageHandle,
          emoji: function() {}
        },
      },
      'emoji-toolbar': true,  //æ˜¯å¦å±•ç¤ºå‡ºæ¥
      "emoji-textarea": false, //æˆ‘ä¸éœ€è¦emojiå±•ç¤ºåœ¨æ–‡æœ¬æ¡†æ‰€ä»¥è®¾ç½®ä¸ºfalse
      "emoji-shortname": true,
    },

    placeholder: 'Write something...',
    // readOnly: true,
    theme: 'snow',
  };
  this.richText = new Quill('#admin-edit-richtext', options)
}
```

ç„¶åæˆ‘çš„Quillç¼–è¾‘å™¨åŸºæœ¬å°±å·®ä¸å¤šäº†ï¼Œæ ·å¼æˆ‘å¤§æ¦‚æŒ‰è¯­é›€çš„å¸ƒå±€å†™äº†ä¸€ä¸‹ï¼Œæ•ˆæœå›¾å¦‚ä¸‹ï¼š
![image.png](https://cdn.laughingzhu.cn/1b63caa1-7db0-4eba-98e4-630665885d0e.png)

### 4.éƒ¨åˆ†APIçš„ä½¿ç”¨ï¼š

å¤§æ¦‚çœ‹äº†ä¸€ä¸‹ï¼Œç›®å‰ç”¨åˆ°çš„ä¸å¤šï¼Œ[å®˜æ–¹APIåœ°å€](https://quilljs.com/docs/api/)

#### getSelection()

æ£€ç´¢ç”¨æˆ·çš„é€‰æ‹©èŒƒå›´ï¼Œå¯é€‰åœ°é¦–å…ˆå…³æ³¨ç¼–è¾‘å™¨ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœç¼–è¾‘æ²¡æœ‰ç„¦ç‚¹ï¼Œå¯èƒ½ä¼šè¿”å›ä¸€ä¸ª`null`

#### insertEmbed()

å‘ç¼–è¾‘å™¨ä¸­æ’å…¥åµŒå…¥å¼å†…å®¹ï¼Œè¿”å›ä¸€ä¸ªæ”¹å˜åçš„Deltaå¯¹è±¡ã€‚æ“ä½œæ¥æºå¯èƒ½ä¸ºï¼šâ€˜userâ€™ã€â€˜apiâ€™æˆ–è€…â€˜silentâ€™ã€‚å½“ç¼–è¾‘å™¨è¢«ç¦ç”¨æ—¶ï¼Œæ¥æºâ€˜userâ€™å°†è¢«å¿½ç•¥ã€‚

#### getLength()

æ£€ç´¢è¿”å›ç¼–è¾‘å™¨çš„å†…å®¹é•¿åº¦ã€‚æ³¨æ„ï¼šå³ä½¿Quillæ˜¯ç©ºçš„ï¼Œç¼–è¾‘å™¨ä»ç„¶æœ‰ä¸€ä¸ªâ€˜\nâ€™è¡¨ç¤ºçš„ç©ºè¡Œï¼Œæ‰€ä»¥getLengthå°†è¿”å›1ã€‚

#### focus()

ç¼–è¾‘å™¨è·å–ç„¦ç‚¹åˆ°æœ€åä½ç½®ã€‚ç”¨äºå®ä¾‹åŒ–å®Œç«‹å³èšç„¦åˆ°ç¼–è¾‘å™¨ã€‚

#### on()

æ·»åŠ äº‹ä»¶ç›‘å¬ã€‚æœ‰å…³äº‹ä»¶æœ¬èº«çš„æ›´å¤šä¿¡æ¯

```javascript
quill.on('text-change', function () {
  console.log('Text change!');
  // æˆ‘åœ¨text-changeè°ƒç”¨äº†quill.getLength()
});
```

#### getContentsï¼ˆï¼‰

æ£€ç´¢ç¼–è¾‘å™¨çš„å†…å®¹ï¼Œæ ¼å¼åŒ–è¿”å›ä¸€ä¸ª[Delta](https://quilljs.com/docs/delta/)å¯¹è±¡ã€‚ä¸€ä¸ªç±»æ•°ç»„çš„æ ¼å¼ã€‚
å¦‚æœæœ‰éœ€è¦**ç›´æ¥è·å–htmlæ ‡ç­¾çš„**å¯ä»¥é€šè¿‡**quill\*\***.container.innerHTML\*\*è·å–åˆ°ï¼Œç›´æ¥æ¸²æŸ“åˆ°HTMLä¸­å³å¯æ˜¾ç¤ºã€‚

ä»¥ä¸Šå°±æ˜¯æˆ‘ç›®å‰åœ¨æˆ‘çš„åšå®¢ç³»ç»Ÿä¸­å¯¹äºQuillå¯Œæ–‡æœ¬ç¼–è¾‘å™¨çš„ä¸€äº›è®°è½½å’Œé‡åˆ°çš„é—®é¢˜ï¼Œä»…ä¾›å‚è€ƒé¸­ğŸ¦†~
æœ‰é—®é¢˜å¯ç•™è¨€äº¤æµã€‚
