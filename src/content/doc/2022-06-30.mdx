---
title: JavaScriptè§„èŒƒä¹‹CommonJS
desc: CommonJS è§„èŒƒçš„ç”±æ¥ã€æ¨¡å—åŒ–çš„å®ç°å’Œä½¿ç”¨æ–¹æ³•ã€‚
publishDate: '2022-06-30'
image: https://cdn.laughingzhu.cn/7955ed1d-ba75-4824-a404-1fc064449cec.png
category: blog
author: LaughingZhu
tags: [Blog, JavaScript]
---

ğŸ¤”ğŸ¤”ä¸ºä»€ä¹ˆæ¨¡å—å¾ˆé‡è¦ï¼Ÿ

éšç€æŠ€æœ¯çš„æ›´æ–°è¿­ä»£ï¼Œé¡¹ç›®çš„å¤æ‚ç¨‹åº¦å¢åŠ ï¼ŒåŠŸèƒ½æ¨¡å—åŒ–ã€å¯å¤ç”¨æ€§å˜çš„è¶Šæ¥è¶Šé‡è¦ã€‚è€Œä¸”æœ‰äº†æ¨¡å—ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç«™åœ¨åˆ«äººçš„è‚©è†€ä¸Šå¼€å‘ï¼Œå…±äº«å…¶å®ƒæŠ€æœ¯ä¼™ä¼´å°è£…çš„åŠŸèƒ½æ¨¡å—ï¼Œè®©å¼€å‘åœ¨ä¸€å®šç¨‹åº¦ä¸Šç®€åŒ–äº†è®¸å¤šğŸ‘¨â€ğŸ’»ã€‚

**ä½†æ˜¯**ï¼šå¦‚æœå¤§å®¶éƒ½æƒ³å…±ç”¨å½¼æ­¤å°è£…çš„æ¨¡å—ï¼Œå°±éœ€è¦ä¸€å¥—ç»Ÿä¸€çš„è§„èŒƒï¼Œä¸ç„¶å¤§å®¶ä¸€äººä¸€ä¸ªæƒ³æ³•ï¼Œä¸€äººä¸€ç§æ–¹å¼ï¼Œè¿™æ ·å¤§å®¶åœ¨ä½¿ç”¨èµ·æ¥å°±å¾ˆå®¹æ˜“ä¹±å¥—ï¼Œäºæ˜¯[CommonJS ](http://javascript.ruanyifeng.com/nodejs/module.html)å’Œ AMD ä¸¤ä¸ªjsç›¸å…³çš„æ¨¡å—åŒ–è§„èŒƒå°±å‡ºç°äº†ã€‚

## CommonJsèƒŒæ™¯

**Nodejs**çš„å‡ºç°è®©JavaScriptåœ¨æœåŠ¡ç«¯ç¼–ç¨‹ä¸­å¯ä»¥å¤§å±•èº«æ‰‹ï¼Œæµè§ˆå™¨ä¸­æ²¡æœ‰æ¨¡å—åŒ–å½±å“ä¸æ˜¯å¾ˆå¤§ï¼Œå› ä¸ºæ—©æœŸçš„webé¡¹ç›®å¤æ‚åº¦ç›¸å¯¹ä¸å¤§ï¼Œå³ä½¿æ²¡æœ‰æ¨¡å—åŒ–ä¾ç„¶å¯ä»¥å¾ˆå®¹æ˜“çš„å®ç°ï¼Œä½†æ˜¯åœ¨æœåŠ¡ç«¯ï¼Œéƒ½æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„åŠŸèƒ½æ¨¡å—ï¼Œè¿™æ ·ä¹Ÿä¾¿äºå’Œæ“ä½œç³»ç»Ÿå’Œå…¶å®ƒåº”ç”¨ç¨‹åºäº¤äº’ã€‚æ‰€ä»¥å¯ä»¥è¯´Nodejsçš„å‡ºç°**åŠ é€Ÿ**äº†"**JavaScriptæ¨¡å—åŒ–ç¼–ç¨‹**"çš„å‡ºç°ã€‚

## CommonJSè§„èŒƒ

Nodejså°±æ˜¯åŸºäºCommonJSè§„èŒƒå»å®ç°çš„ï¼Œ[ç»´åŸºç™¾ç§‘](https://zh.wikipedia.org/wiki/CommonJS)ä¸­è¿™æ ·æè¿°CommonJSã€‚

> CommonJS æ˜¯ä¸€ä¸ªé¡¹ç›®ï¼Œå…¶ç›®æ ‡æ˜¯ä¸º JavaScript åœ¨ç½‘é¡µæµè§ˆå™¨ä¹‹å¤–åˆ›å»ºæ¨¡å—çº¦å®šã€‚åˆ›å»ºè¿™ä¸ªé¡¹ç›®çš„ä¸»è¦åŸå› æ˜¯å½“æ—¶ç¼ºä¹æ™®éå¯æ¥å—å½¢å¼çš„ JavaScript è„šæœ¬æ¨¡å—å•å…ƒï¼Œæ¨¡å—åœ¨ä¸è¿è¡ŒJavaScript è„šæœ¬çš„å¸¸è§„ç½‘é¡µæµè§ˆå™¨æ‰€æä¾›çš„ä¸åŒçš„ç¯å¢ƒä¸‹å¯ä»¥é‡å¤ä½¿ç”¨ã€‚

## CommonJSæ¦‚è¿°

Nodeåº”ç”¨ç”±æ¨¡å—ç»„æˆï¼Œé‡‡ç”¨ CommonJS æ¨¡å—è§„èŒƒã€‚æ¯ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæœ‰è‡ªå·±çš„ä½œç”¨åŸŸã€‚åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢å®šä¹‰çš„å˜é‡ã€å‡½æ•°ã€ç±»ï¼Œéƒ½æ˜¯ç§æœ‰çš„ï¼Œå¯¹å…¶ä»–æ–‡ä»¶ä¸å¯è§ã€‚

```javascript
// example.js
var x = 5;
var addX = function (value) {
  return value + x;
};
```

ä¸Šçº¿ä»£ç ä¸­å˜é‡xå’Œå–Šå‡ºaddXæ˜¯å½“å‰æ–‡ä»¶example.jsç§æœ‰çš„ï¼Œå…¶ä»–æ–‡ä»¶ä¸å¯è§ã€‚å¦‚æœæƒ³åœ¨å¤šä¸ªæ–‡ä»¶åˆ†äº«å˜é‡ä»¬å¿…é¡»å®šä¹‰ä¸ºglobalå¯¹è±¡çš„å±æ€§ã€‚

```javascript
global.warning = true;
```

ä¸Šé¢ä»£ç çš„warningå˜é‡å¯ä»¥è¢«æ‰€æœ‰æ–‡ä»¶è¯»å–ã€‚ä½†æ˜¯è¿™ç§å†™æ³•å¾ˆå®¹æ˜“é€ æˆå˜é‡çš„å€¼ä¸æŒ‰é€»è¾‘å‡ºç°ï¼ˆç±»å‹å±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡ï¼‰ã€‚

CommonJSè§„èŒƒè§„å®šï¼Œæ¯ä¸ªæ¨¡å—å†…éƒ¨æœ‰ä¸¤ä¸ªå˜é‡å¯ä»¥ä½¿ç”¨ï¼Œrequireå’Œmoduleã€‚moduleå˜é‡ä»£è¡¨å½“å‰æ¨¡å—ï¼Œæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„exportså±æ€§ï¼ˆåŠmodule.exportsï¼‰æ˜¯å¯¹å¤–çš„æ¥å£å³ä¿å­˜äº†å½“å‰æ¨¡å—è¦å¯¼å‡ºçš„æ¥å£æˆ–è€…å˜é‡ï¼Œä½¿ç”¨requireåŠ è½½çš„æŸä¸ªæ¨¡å—è·å–åˆ°çš„å€¼å°±æ˜¯é‚£ä¸ªæ¨¡å—ä½¿ç”¨exportså¯¼å‡ºçš„å±æ€§å€¼ã€‚

```javascript
// example.js
var x = 5;
var addX = function (value) {
  return value + x;
};
module.exports.x = x;
module.exports.addX = addX;

// main.js
var example = require('./example.js');

console.log(example.x); // 5
console.log(example.addX(1)); // 6
```

ä¸Šé¢ä»£ç example.jsé€šè¿‡module.exports è¾“å‡ºå˜é‡ x å’Œå‡½æ•° addXï¼Œåœ¨main.js é¡µé¢ä¸­é€šè¿‡requireåŠ è½½æ¨¡å—ã€‚

## CommonJSä¹‹exportså˜é‡

ä¸ºäº†æ–¹ä¾¿ï¼ŒNodeä¸ºæ¯ä¸ªæ¨¡å—æä¾›ä¸€ä¸ªexportså˜é‡ï¼ŒæŒ‡å‘module.exportsã€‚è¿™ç­‰åŒäºåœ¨æ¯ä¸ªæ¨¡å—å¤´éƒ¨ï¼Œæ·»åŠ äº†ä¸€æ ·è¿™æ ·çš„ä»£ç ã€‚

```javascript
var exports = module.exports;
```

é€ æˆçš„ç»“æœæ˜¯ï¼Œåœ¨å¯¹å¤–è¾“å‡ºæ¨¡å—æ¥å£æ—¶ï¼Œå¯ä»¥ç›´æ¥å‘exportså¯¹è±¡æ·»åŠ æ–¹æ³•ã€‚

```javascript
exports.area = function (r) {
  return Math.PI * r * r;
};

exports.circumference = function (r) {
  return 2 * Math.PI * r;
};
```

![v2-bb07cfbabecbda5ce54e0f3d0f7c3a17_1440w.jpg](https://cdn.laughingzhu.cn/v2-bb07cfbabecbda5ce54e0f3d0f7c3a17_1440w.jpg)
**æ³¨æ„ï¼šä¸èƒ½ç›´æ¥å°†exportså˜é‡æŒ‡å‘ä¸€ä¸ªå€¼ï¼Œå› ä¸ºè¿™æ ·ç­‰äºåˆ‡æ–­äº†exportsäºmodule.exportsçš„è”ç³»ã€‚**

![v2-84892ebe670d53a22c44a652923c18f2_1440w.jpg](https://cdn.laughingzhu.cn/v2-84892ebe670d53a22c44a652923c18f2_1440w.jpg)

**è¿™æ„å‘³å¦‚æœä¸€ä¸ªæ¨¡å—çš„å¯¹å¤–æ¥å£æ˜¯ä¸€ä¸ªå•ä¸€çš„å€¼æˆ–è€…å‡½æ•°çš„è¯ï¼Œä¸èƒ½ä½¿ç”¨exportsè¾“å‡ºï¼Œåªèƒ½ä½¿ç”¨module.exportsè¾“å‡ºã€‚**

```javascript
// example_1
module.exports = function (x) {
  console.log(x);
};

// example_2
var name = 'morrain';
module.exports = name;
```

## CommonJSä¹‹requireå˜é‡

Nodeä½¿ç”¨CommonJSè§„èŒƒï¼Œå†…ç½®çš„requireå‘½ä»¤ç”¨äºåŠ è½½æ¨¡å—æ–‡ä»¶ã€‚
requireå‘½ä»¤çš„åŸºæœ¬åŠŸèƒ½å››è¯»å…¥å¹¶æ‰§è¡Œä¸€ä¸ªJavaScriptæ–‡ä»¶ï¼Œç„¶åè¿”å›è¯¥æ¨¡å—çš„exportså¯¹è±¡ã€‚å¦‚æœæ²¡æœ‰å‘ç°è¯¥æ¨¡å—ï¼Œä¼šæŠ¥é”™ã€‚

```javascript
// module.js
var name = 'morrain';
var age = 18;
exports.name = name;
exports.getAge = function () {
  return age;
};

// main.js
var a = require('a.js');
console.log(a.name); // 'morrain'
a.name = 'rename';
var b = require('a.js');
console.log(b.name); // 'rename'
```

**æ¨¡å—çš„ç¼“å­˜ï¼š**
ç¬¬ä¸€æ¬¡åŠ è½½æŸä¸ªæ¨¡å—æ—¶ï¼ŒNodeä¼šç¼“å­˜è¯¥æ¨¡å—ã€‚ä»¥åå†åŠ è½½è¯¥æ¨¡å—ï¼Œå°±ç›´æ¥ä»ç¼“å­˜å–å‡ºè¯¥æ¨¡å—çš„module.exportså±æ€§ã€‚

```javascript
// a.js
var name = 'morrain';
var age = 18;
exports.name = name;
exports.getAge = function () {
  return age;
};
// b.js
var a = require('a.js');
console.log(a.name); // 'morrain'
a.name = 'rename';
var b = require('a.js');
console.log(b.name); // 'rename'
```

å¦‚ä¸Šæ‰€ç¤ºï¼Œç¬¬äºŒæ¬¡requireåŠ è½½æ¨¡å—Aæ—¶ï¼Œå¹¶æ²¡æœ‰é‡æ–°åŠ è½½å¹¶æ‰§è¡Œæ¨¡å—Aã€‚è€Œæ˜¯ç›´æ¥è¿”å›äº†ç¬¬ä¸€æ¬¡requireçš„ç»“æœï¼Œä¹Ÿå°±æ˜¯æ¨¡å—Açš„module.exportsã€‚

![v2-c8ffb2894b275a7ad27f27a12378f57b_1440w.jpg](https://cdn.laughingzhu.cn/v2-c8ffb2894b275a7ad27f27a12378f57b_1440w.jpg)

è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼ŒCommonJsæ¨¡å—åŠ è½½çš„æœºåˆ¶æ˜¯ï¼Œè¾“å…¥çš„æ˜¯å¯¹è¾“å‡ºå€¼çš„æ‹·è´ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦è¾“å‡ºä¸€ä¸ªå€¼ï¼Œæ¨¡å—å†…éƒ¨çš„å˜åŒ–å°±å½±å“ä¸åˆ°è¿™ä¸ªå€¼ã€‚

```javascript
// lib.js
var counter = 3;
function incCounter() {
  counter++;
}

module.exports = {
  counter: counter,
  incCounter: incCounter
};
```

ä¸Šé¢ä»£ç è¾“å‡ºå†…éƒ¨å˜é‡counterå’Œæ”¹å†™è¿™ä¸ªå˜é‡çš„å†…éƒ¨æ–¹æ³•incCounterã€‚
ç„¶ååŠ è½½ä¸Šé¢çš„æ¨¡å—ã€‚

```javascript
/ main.js
var mod = require('./lib');

console.log(mod.counter);  // 3
mod.incCounter();
console.log(mod.counter); // 3
```

ä¸Šé¢ä»£ç è¯´æ˜counterè¾“å‡ºä¹‹åï¼Œlib.jsæ¨¡å—å†…éƒ¨çš„å˜åŒ–å°±å½±å“ä¸åˆ°counteräº†ã€‚è¿™æ˜¯å› ä¸ºmod.counteræ˜¯ä¸€ä¸ªåŸå§‹ç±»å‹çš„å€¼ï¼Œä¼šè¢«ç¼“å­˜ã€‚é™¤éå†™æˆä¸€ä¸ªå–Šå‡ºï¼Œæ‰èƒ½è·å–åˆ°å†…éƒ¨å˜åŠ¨çš„å€¼ã€‚ä¿®æ”¹èº«è¾¹lib.jsæ–‡ä»¶å¦‚ä¸‹ï¼š

```javascript
// lib.js
var counter = 3;
function incCounter() {
  counter++;
}
module.exports = {
  get counter() {
    return counter
  },
  incCounter: incCounter,
};


// testï¼Œæ‰§è¡Œmain.js è¾“å‡ºç»“æœå¦‚ä¸‹
$ node main.js
3
4
```

## CommonJSå®ç°

äº†è§£äº†CommonJsçš„è§„èŒƒä¹‹åï¼Œä¸éš¾å‘ç°æˆ‘ä»¬åœ¨ç¬¦åˆCommonJsè§„èŒƒçš„æ¨¡å—æ—¶ï¼Œæ— å¤–ä¹å°±æ˜¯ä½¿ç”¨äº†requireã€exportsã€moduleä¸‰ä¸ªä¸œè¥¿ï¼Œç„¶åä¸€ä¸ªjsæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ã€‚

```javascript
// a.js
var name = 'lilei';
var age = 15;
exports.name = name;
exports.getAge = function () {
  return age;
};

// index.js
var b = require('b.js');
console.log('b.name=', b.name);
```

å¦‚æœæˆ‘ä»¬å‘ä¸€ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°æä¾› requireã€exportsã€module ä¸‰ä¸ªå‚æ•°ï¼Œæ¨¡å—ä»£ç æ”¾åœ¨è¿™ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°é‡Œé¢ï¼Œæ¨¡å—çš„å¯¼å‡ºå€¼æ”¾åœ¨ module.exports ä¸­ï¼Œè¿™æ ·å°±å®ç°äº†æ¨¡å—çš„åŠ è½½ã€‚å¦‚ä¸‹ï¼š

```javascript
(function (module, exports, require) {
  var name = 'lilei';
  var age = 15;
  exports.name = name;
  exports.getAge = function () {
    return age;
  };
})(module, module.exports, require);
```

çŸ¥é“è¿™ä¸ªåŸç†åï¼Œæˆ‘ä»¬å°±å¾ˆå®¹æ˜“å†™å‡ºç¬¦åˆCommonJSè§„èŒƒçš„ä»£ç æ¨¡å—ï¼Œè¾“å‡ºä¸€äº›é«˜å“è´¨çš„Nodejsåº“ã€‚

---

## å‚è€ƒé“¾æ¥ï¼š

[å‰ç«¯ç§‘æ™®ç³»åˆ—-CommonJSï¼šä¸æ˜¯å‰ç«¯å´é©å‘½äº†å‰ç«¯](https://zhuanlan.zhihu.com/p/113009496)
[CommonJSè§„èŒƒï¼ˆalphaï¼‰](http://javascript.ruanyifeng.com/nodejs/module.html)
[ECMAScript6å…¥é—¨](https://es6.ruanyifeng.com/#docs/module-loader)

å¦‚æœ‰ç‰ˆæƒé—®é¢˜è¯·è”ç³»æˆ‘ğŸ˜‘
